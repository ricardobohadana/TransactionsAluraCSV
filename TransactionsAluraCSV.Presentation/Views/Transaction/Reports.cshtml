@using System.Globalization
@model TransactionsAluraCSV.Presentation.Models.TransactionReportsModel
@{
    ViewData["Title"] = "Reports";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card mb-5">
    <header class="card-header">
        <h1 class="title is-3 p-5">Relatório de atividades suspeitas</h1>
    </header>
    <div class="card-content">
            @using (Html.BeginForm())
            {
            <div class="field is-grouped has-addons">
                <div class="field">
                    <p class="control mr-5">
                        <div class="select">
                            @Html.DropDownListFor(model => model.Month, Model.MonthList, "Escolha um mês", new {@class="select"})
                        </div>
                    </p>
                    <p class="help is-danger">@Html.ValidationMessageFor(model => model.Month)</p>
                </div>
                <div class="field">
                    <p class="control ml-5">
                        @Html.TextBoxFor(model => model.Year, new {@class="input has-text-centered pr-5", @placeholder="2021", @type="number", @Value="2021"})
                    </p>
                    <p class="help is-danger">@Html.ValidationMessageFor(model => model.Year)</p>
                </div>
                <div class="control">
                    <input class="button is-info" value="Analisar" type="submit" />
                </div>
            </div>  
            }
    </div>
</div>
@if(Model.SuspiciousData != null)
{
    
    @* Transações suspeitas*@
    <div class="card mb-5">
        <header class="card-header">
            <h1 class="title is-3 p-5">Transações suspeitas</h1>
        </header>
        @if(Model.SuspiciousData.SuspiciousTransfers.Count() == 0)
        {
             <div class="notification is-warning is-light">
                Não há transações suspeitas no período especificado.
            </div>
        }
        else
        {
            <div class="card-content">
                <table class="table is-hoverable is-fullwidth is-bordered is-striped">
                    <thead>
                        <tr>
                            <th colspan="3" class="is-vcentered has-text-centered">ORIGEM</th>
                            <th colspan="3" class="is-vcentered has-text-centered">DESTINO</th>
                            <th colspan="1" class="is-vcentered has-text-right">VALOR</th>
                        </tr>
                        <tr>
                            <th class="is-vcentered">Banco</th>
                            <th class="is-vcentered has-text-right">Agencia</th>
                            <th class="is-vcentered has-text-right">Conta</th>
                            <th class="is-vcentered">Banco</th>
                            <th class="is-vcentered has-text-right">Agencia</th>
                            <th class="is-vcentered has-text-right">Conta</th>
                            <th class="is-vcentered has-text-right">
                                Valor da Transação
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var t in Model.SuspiciousData.SuspiciousTransfers)
                        {
                            <tr key={index}>
                            <td class="is-vcentered">@t.OriginBank</td>
                            <td class="is-vcentered has-text-right">@t.OriginAgency</td>
                            <td class="is-vcentered has-text-right">@t.OriginAccount</td>
                            <td class="is-vcentered">@t.DestinationBank</td>
                            <td class="is-vcentered has-text-right">@t.DestinationAgency</td>
                            <td class="is-vcentered has-text-right">@t.DestinationAccount</td>
                            <td class="is-vcentered has-text-right">
                                @t.TransferAmount.ToString("C", CultureInfo.CurrentCulture)
                            </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }

    </div>
    @* Contas suspeitas *@
    <div class="card mb-5">
        <header class="card-header">
            <h1 class="title is-3 p-5">Contas suspeitas</h1>
        </header>

        @if(Model.SuspiciousData.SuspiciousAccounts.Count() == 0)
        {
            <div class="notification is-warning is-light">
                Não há contas suspeitas no período especificado.
            </div>
        }
        else
        {
            <div class="card-content">
                <table class="table is-hoverable is-fullwidth is-bordered is-striped">
                    <thead>
                        <tr>
                            <th class="is-vcentered">BANCO</th>
                            <th class="is-vcentered has-text-right">AGÊNCIA</th>
                            <th class="is-vcentered has-text-right">CONTA</th>
                            <th class="is-vcentered has-text-right">MOVIMENTAÇÃO</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sa in Model.SuspiciousData.SuspiciousAccounts)
                        {
                            <tr>
                                <td class="is-vcentered">@sa.Bank</td>
                                <td class="is-vcentered has-text-right">@sa.Agency</td>
                                <td class="is-vcentered has-text-right">@sa.Account</td>
                                <td class="is-vcentered has-text-right">@sa.Movement.ToString("C", CultureInfo.CurrentCulture)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    
    </div>
    @* Agencias suspeitas *@
    <div class="card">
        <header class="card-header">
            <h1 class="title is-3 p-5">Agências suspeitas</h1>
        </header>
        @if(Model.SuspiciousData.SuspiciousAgencies.Count() == 0)
        {
            <div class="notification is-warning is-light">
                Não há agências suspeitas no período especificado.
            </div>
        }
        else
        {
            <div class="card-content">
                <table class="table is-hoverable is-fullwidth is-bordered is-striped">
                    <thead>
                        <tr>
                            <th class="is-vcentered">BANCO</th>
                            <th class="is-vcentered has-text-right">AGÊNCIA</th>
                            <th class="is-vcentered has-text-right">MOVIMENTAÇÃO</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sa in Model.SuspiciousData.SuspiciousAgencies)
                        {
                            <tr>
                                <td class="is-vcentered">@sa.Bank</td>
                                <td class="is-vcentered has-text-right">@sa.Agency</td>
                                <td class="is-vcentered has-text-right">@sa.Movement.ToString("C", CultureInfo.CurrentCulture)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
}
